From a3ebdeb6d9ba35a703e47d4323cf126ce12a7cdf Mon Sep 17 00:00:00 2001
From: Robert Kolchmeyer <rkolchmeyer@google.com>
Date: Fri, 13 Oct 2017 09:38:49 -0700
Subject: [PATCH] Cross-compiler patch.

---
 components/engine/hack/make/.binary     | 8 ++++----
 components/engine/hack/make/.go-autogen | 4 ++--
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/components/engine/hack/make/.binary b/components/engine/hack/make/.binary
index ff5cbff722..dad8994ce4 100644
--- a/components/engine/hack/make/.binary
+++ b/components/engine/hack/make/.binary
@@ -3,7 +3,7 @@ set -e
 
 # a helper to provide ".exe" when it's appropriate
 binary_extension() {
-	if [ "$(go env GOOS)" = 'windows' ]; then
+	if [ "$($GO env GOOS)" = 'windows' ]; then
 		echo -n '.exe'
 	fi
 }
@@ -40,9 +40,9 @@ hash_files() {
 (
 export GOGC=${DOCKER_BUILD_GOGC:-1000}
 
-if [ "$(go env GOOS)/$(go env GOARCH)" != "$(go env GOHOSTOS)/$(go env GOHOSTARCH)" ]; then
+if [ "$($GO env GOOS)/$($GO env GOARCH)" != "$($GO env GOHOSTOS)/$($GO env GOHOSTARCH)" ]; then
 	# must be cross-compiling!
-	case "$(go env GOOS)/$(go env GOARCH)" in
+	case "$($GO env GOOS)/$($GO env GOARCH)" in
 		windows/amd64)
 			export CC=x86_64-w64-mingw32-gcc
 			export CGO_ENABLED=1
@@ -51,7 +51,7 @@ if [ "$(go env GOOS)/$(go env GOARCH)" != "$(go env GOHOSTOS)/$(go env GOHOSTARC
 fi
 
 echo "Building: $DEST/$BINARY_FULLNAME"
-go build \
+$GO build \
 	-o "$DEST/$BINARY_FULLNAME" \
 	"${BUILDFLAGS[@]}" \
 	-ldflags "
diff --git a/components/engine/hack/make/.go-autogen b/components/engine/hack/make/.go-autogen
index ec20180672..1ac3193cea 100644
--- a/components/engine/hack/make/.go-autogen
+++ b/components/engine/hack/make/.go-autogen
@@ -40,12 +40,12 @@ const (
 DVEOF
 
 # Compile the Windows resources into the sources
-if [ "$(go env GOOS)" = "windows" ]; then
+if [ "$($GO env GOOS)" = "windows" ]; then
 	mkdir -p autogen/winresources/tmp autogen/winresources/docker autogen/winresources/dockerd
 	cp hack/make/.resources-windows/resources.go autogen/winresources/docker/
 	cp hack/make/.resources-windows/resources.go autogen/winresources/dockerd/
 
-	if [ "$(go env GOHOSTOS)" == "windows" ]; then
+	if [ "$($GO env GOHOSTOS)" == "windows" ]; then
 		WINDRES=windres
 		WINDMC=windmc
 	else
-- 
2.15.0.rc0.271.g36b669edcc-goog

