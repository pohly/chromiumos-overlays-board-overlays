# Copyright 2018 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

description   "Workaround for Fizz fan issue in M67"
author        "chromium-os-dev@chromium.org"

start on started boot-services

script
  fan_info=$(ectool pwmgetfanrpm)
  logger -t "fan-rpm[${PPID}]" "${fan_info}"
  if [ "${fan_info}" = "Fan 0 RPM: 0" ]; then
    ectool pwmsetfanrpm 2800
    ectool autofanctrl
    logger -t "fan-rpm[${PPID}]" "Set Fan 0 rpm to 2800."
  fi
end script
